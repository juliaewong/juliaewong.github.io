<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Julia Wong â€“ Interactive PCB</title>

  <!-- model-viewer -->
  <script
    type="module"
    src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js">
  </script>

  <style>
    body {
      margin: 0;
      background: #e6e6ee;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }

    model-viewer {
      width: 90vw;
      height: 90vh;
    }

    .pcb-button {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0);
      border: 2px solid rgba(255, 255, 255, 0);
      cursor: pointer;
    }

    .ui-overlay {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 10;
    }

    .ui-panel {
      pointer-events: auto;
      background: rgba(255, 255, 255, 0.85);
      border: 1px solid rgba(0, 0, 0, 0.12);
      border-radius: 10px;
      padding: 10px 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      backdrop-filter: blur(6px);
      font-size: 14px;
      line-height: 1.4;
    }

    .ui-exit {
      position: absolute;
      top: 16px;
      left: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }

    .ui-exit kbd {
      font-family: monospace;
      background: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 2px 6px;
      font-size: 12px;
    }

    .ui-instructions {
      position: absolute;
      bottom: 20px;
      left: 20px;
      max-width: 320px;
    }

    .ui-instructions strong {
      display: block;
      margin-bottom: 6px;
    }

    /* ===== Fallback Notice ===== */
    #fallbackNotice {
      position: fixed;
      inset: 0;
      background: rgba(230,230,238,0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    #fallbackNotice .box {
      background: white;
      padding: 20px 24px;
      border-radius: 12px;
      max-width: 360px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }

    #fallbackNotice strong {
      display: block;
      margin-bottom: 8px;
    }
  </style>
</head>

<body>

  <!-- ===== UI OVERLAY ===== -->
  <div class="ui-overlay">
    <div class="ui-panel ui-exit" onclick="exitPCB()">
      <kbd>ESC</kbd>
      <span>Exit PCB view</span>
    </div>

    <div class="ui-panel ui-instructions">
      <strong>How to interact</strong>
      ðŸ–± Click + drag to rotate the board<br>
      â‡§ Hold <b>Shift</b> + drag to pan<br><br>
      ðŸ”˜ Click components to explore the site
    </div>
  </div>

  <!-- ===== 3D PCB VIEWER ===== -->
  <model-viewer
    id="pcb"
    src="pcb_site.glb"
    alt="Interactive PCB portfolio"
    camera-controls
    auto-rotate
    rotation-per-second="12deg"
    camera-target="0m 0m 0m"
    camera-orbit="45deg 65deg 2.5m"
    exposure="1.25"
    shadow-intensity="1"
    tone-mapping="aces"
    interaction-prompt="none">

    <button
      class="pcb-button"
      slot="hotspot-resume"
      data-position="0m 0.01m 0.02m"
      data-normal="0m 1m 0m"
      onclick="goResume()">
    </button>

    <button
      class="pcb-button"
      slot="hotspot-timeline"
      data-position="0.03m 0.01m -0.01m"
      data-normal="0m 1m 0m"
      onclick="goTimeline()">
    </button>

  </model-viewer>

  <!-- ===== FALLBACK POPUP ===== -->
  <div id="fallbackNotice">
    <div class="box">
      <strong>Best viewed on desktop</strong>
      <p style="margin:0; font-size:14px; line-height:1.5;">
        This interactive 3D experience works best on a computer or laptop.
        Redirecting you to a simplified viewâ€¦
      </p>
    </div>
  </div>

  <!-- ===== SCRIPT ===== -->
  <script>
    function showFallbackAndRedirect(url) {
      document.getElementById("fallbackNotice").style.display = "flex";
      setTimeout(() => {
        window.location.replace(url);
      }, 2000);
    }

    /* --- iOS Safari hard fallback --- */
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);

    if (isIOS && isSafari) {
      showFallbackAndRedirect("timeline.html");
    }

    function goResume() {
      window.location.href = "resume.html";
    }

    function goTimeline() {
      window.location.href = "timeline.html";
    }

    function exitPCB() {
      window.location.href = "Home.html";
    }

    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") exitPCB();
    });

    const viewer = document.getElementById("pcb");
    let modelLoaded = false;

    viewer.addEventListener("load", () => {
      modelLoaded = true;
      const model = viewer.model;
      if (!model) return;

      model.materials.forEach(mat => {
        mat.doubleSided = true;
        if (mat.pbrMetallicRoughness) {
          mat.pbrMetallicRoughness.metallicFactor *= 0.6;
          mat.pbrMetallicRoughness.roughnessFactor *= 0.9;
        }
        const name = (mat.name || "").toLowerCase();
        if (name.includes("display") || name.includes("segment")) {
          mat.pbrMetallicRoughness.baseColorFactor[3] = 0.15;
        }
      });
    });

    viewer.addEventListener("error", () => {
      showFallbackAndRedirect("timeline.html");
    });

    setTimeout(() => {
      if (!modelLoaded) {
        showFallbackAndRedirect("timeline.html");
      }
    }, 4000);
  </script>

</body>
</html>
