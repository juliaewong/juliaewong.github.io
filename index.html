<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Julia Wong â€“ Interactive PCB</title>

  <!-- model-viewer (safe to load unconditionally) -->
  <script
    type="module"
    src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js">
  </script>

  <style>
    body {
      margin: 0;
      background: #e6e6ee;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }

    model-viewer {
      width: 90vw;
      height: 90vh;
    }

    .pcb-button {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0);
      border: 2px solid rgba(255, 255, 255, 0);
      cursor: pointer;
    }

    .ui-overlay {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 10;
    }

    .ui-panel {
      pointer-events: auto;
      background: rgba(255, 255, 255, 0.85);
      border: 1px solid rgba(0, 0, 0, 0.12);
      border-radius: 10px;
      padding: 10px 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      backdrop-filter: blur(6px);
      font-size: 14px;
      line-height: 1.4;
    }

    .ui-exit {
      position: absolute;
      top: 16px;
      left: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }

    .ui-exit kbd {
      font-family: monospace;
      background: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 2px 6px;
      font-size: 12px;
    }

    .ui-instructions {
      position: absolute;
      bottom: 20px;
      left: 20px;
      max-width: 320px;
    }

    .ui-instructions strong {
      display: block;
      margin-bottom: 6px;
    }
  </style>
</head>

<body>

  <!-- ===== UI OVERLAY ===== -->
  <div class="ui-overlay">
    <div class="ui-panel ui-exit" onclick="exitPCB()">
      <kbd>ESC</kbd>
      <span>Exit PCB view</span>
    </div>

    <div class="ui-panel ui-instructions">
      <strong>How to interact</strong>
      ðŸ–± Click + drag to rotate the board<br>
      â‡§ Hold <b>Shift</b> + drag to pan<br><br>
      ðŸ”˜ Click components to explore the site
    </div>
  </div>

  <!-- ===== 3D PCB VIEWER ===== -->
  <model-viewer
    id="pcb"
    src="pcb_site.glb"
    alt="Interactive PCB portfolio"
    camera-controls
    auto-rotate
    rotation-per-second="12deg"
    camera-target="0m 0m 0m"
    camera-orbit="45deg 65deg 2.5m"
    exposure="1.25"
    shadow-intensity="1"
    tone-mapping="aces"
    interaction-prompt="none">

    <!-- ðŸ”˜ RESUME BUTTON -->
    <button
      class="pcb-button"
      slot="hotspot-resume"
      data-position="0m 0.01m 0.02m"
      data-normal="0m 1m 0m"
      onclick="goResume()">
    </button>

    <!-- ðŸ”˜ TIMELINE BUTTON -->
    <button
      class="pcb-button"
      slot="hotspot-timeline"
      data-position="0.03m 0.01m -0.01m"
      data-normal="0m 1m 0m"
      onclick="goTimeline()">
    </button>

  </model-viewer>

  <!-- ===== SCRIPT ===== -->
  <script>
    /* -------- iOS Safari hard fallback (RUNS FIRST) -------- */
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);

    if (isIOS && isSafari) {
      window.location.replace("timeline.html");
    }

    /* -------- Navigation -------- */
    function goResume() {
      window.location.href = "resume.html";
    }

    function goTimeline() {
      window.location.href = "timeline.html";
    }

    function exitPCB() {
      window.location.href = "Home.html";
    }

    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") exitPCB();
    });

    /* -------- PCB-only logic -------- */
    const viewer = document.getElementById("pcb");
    const FALLBACK_URL = "timeline.html";
    let modelLoaded = false;

    if (viewer) {

      viewer.addEventListener("load", () => {
        modelLoaded = true;

        const model = viewer.model;
        if (!model) return;

        model.materials.forEach(mat => {
          mat.doubleSided = true;

          if (mat.pbrMetallicRoughness) {
            mat.pbrMetallicRoughness.metallicFactor *= 0.6;
            mat.pbrMetallicRoughness.roughnessFactor *= 0.9;
          }

          const name = (mat.name || "").toLowerCase();
          if (name.includes("display") || name.includes("segment")) {
            const base = mat.pbrMetallicRoughness.baseColorFactor;
            base[3] = 0.15;
          }
        });
      });

      viewer.addEventListener("error", () => {
        window.location.replace(FALLBACK_URL);
      });

      setTimeout(() => {
        if (!modelLoaded) {
          window.location.replace(FALLBACK_URL);
        }
      }, 4000);
    }
  </script>

</body>
</html>
